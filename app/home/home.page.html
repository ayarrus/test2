<ion-content [fullscreen]="true">
  <ion-header>
    <ion-toolbar color="#04a0d0">
      <mat-grid-list cols="2" rowHeight="50px">
        <mat-grid-tile>
          <ion-menu-button menu="firstMenu" color="white"></ion-menu-button>
          <ion-title>
            <ion-img src="assets/img/ASSA ABLOY White.svg" style="width: 40%; margin: 10px;"></ion-img>
          </ion-title>
        </mat-grid-tile>
        <mat-grid-tile>
          <div style="margin-inline-start:auto;">
            <button mat-button (click)="logout()">
              <mat-label style="color: white; padding-right: 5px;">Salir</mat-label>
              <mat-icon style="color: white;">logout</mat-icon>
            </button>
          </div>
        </mat-grid-tile>
      </mat-grid-list>
    </ion-toolbar>
  </ion-header>
  <div class="container">
    <div class="row">
      <!-- <mat-grid-list cols="4" rowHeight="175px">
        <mat-grid-tile>
          <mat-card>
            <mat-card-title>
              Reportados Ult. 24hs
            </mat-card-title>
            <mat-card-content>
              {{Last24Hs}}
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
        <mat-grid-tile>
          <mat-card>
            <mat-card-title>
              Online
            </mat-card-title>
            <mat-card-content>
              {{Online}}
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
        <mat-grid-tile>
          <mat-card>
            <mat-card-title>
              Offline Ult. 5 min.
            </mat-card-title>
            <mat-card-content>
              {{OfflineLast5Mins}}
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
        <mat-grid-tile>
          <mat-card>
            <mat-card-title>
              Offline Mas de 5 min.
            </mat-card-title>
            <mat-card-content>
              {{OfflineMoreThan5Mins}}
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
      </mat-grid-list> -->

      <div class="divFlotante col-md-12">
        <!-- <div class="divFlotante"> -->
        <mat-form-field class="form-field" appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput type="text" [(ngModel)]="emailFormControl" style="height: 20px;"
            (keypress)="$event.keyCode == 13 ? dataLoad('load', null) : null" placeholder="Ex.pat@example.com">
          <!-- <mat-error *ngIf="emailFormControl.hasError('email')">
            Por favor ingrese un email valido
          </mat-error> -->
        </mat-form-field>
        <mat-form-field class="form-field" appearance="outline">
          <mat-label>MAC ADDRESS</mat-label>
          <input matInput type="text" [(ngModel)]="MAC" style="height: 20px;">
          <button *ngIf="MAC" matSuffix mat-icon-button aria-label="Clear"
            (keypress)="$event.keyCode == 13 ? dataLoad('load', null) : null" (click)="MAC=''">
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
        <button mat-raised-button color="primary" [disabled]="formStatus === 1" (click)="dataLoad('load', null)">
          <mat-icon>search</mat-icon>
          Buscar
        </button>
        <!-- </div> -->
      </div>

      <br>
      <br>
      <br>

      <div class="col-md-12">
        <div class="col-md-2">
          <button mat-button class="btn-flotante" (click)="dataLoad('reload', null)">
            <mat-icon>autorenew</mat-icon>
          </button>
        </div>
        <div class="col-md-2">
          <button mat-button class="btn-flotanteCopy" (click)="copyAll()">
            <mat-icon>assignment</mat-icon>
          </button>
        </div>
        <div class="action-buttons">
          <button mat-button (click)="accordion.openAll()">Expand All</button>
          <button mat-button (click)="accordion.closeAll()">Collapse All</button>
        </div>
        <mat-progress-bar *ngIf="progressBar" mode="indeterminate"></mat-progress-bar>
        <mat-accordion class="headers-align" multi>
          <mat-expansion-panel [disabled]="ExpansionPanelAccountDisable" [expanded]="ExpansionPanelAccountExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="iconMargin">account_circle</mat-icon>
                Cuentas
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="divAccounts">
              <button mat-icon-button (click)="copyData('Account')">
                <mat-icon>assignment</mat-icon>
              </button>
            </div>
            <table mat-table [dataSource]="dsAccounts">
              <!--- Note that these columns can be defined in any order.
                The actual rendered columns are set as a property on the row definition" -->

              <!-- HomeID Column -->
              <ng-container matColumnDef="accountID">
                <th mat-header-cell *matHeaderCellDef> AccountID </th>
                <td mat-cell *matCellDef="let element"> {{element.accountID}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef> Email </th>
                <td mat-cell *matCellDef="let element">
                  <div style="display: flex;">
                    <mat-icon (click)="dataLoad('load',element)" class="searchClass" *ngIf="searchAccount">search</mat-icon>
                    {{element.email}}
                  </div>
                </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef> Nombre </th>
                <td mat-cell *matCellDef="let element"> {{element.nombre}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="apellido">
                <th mat-header-cell *matHeaderCellDef> Apellido </th>
                <td mat-cell *matCellDef="let element"> {{element.apellido}} </td>
              </ng-container>

              <!-- CreationDateLocal Column -->
              <ng-container matColumnDef="activatedOn">
                <th mat-header-cell *matHeaderCellDef> Fecha de Activación (UTC) </th>
                <td mat-cell *matCellDef="let element"> {{element.activatedOn | date:'yyyy-MM-dd HH:mm:ss'}} </td>
              </ng-container>

              <!-- Virtual Column -->
              <ng-container matColumnDef="enabled">
                <th mat-header-cell *matHeaderCellDef> Estado </th>
                <td mat-cell *matCellDef="let element">
                  <button mat-button [color]="(element.enabled && element.activatedOn) ? 'primary' : 'warn'">
                    {{element.enabled && element.activatedOn ? 'Activo' : 'Desactivo'}}
                  </button>
                </td>
              </ng-container>

              <ng-container matColumnDef="reenviar">
                <th mat-header-cell *matHeaderCellDef> Reenviar </th>
                <td mat-cell *matCellDef="let element">
                  <button mat-button *ngIf="!element.activatedOn" (click)="resend(element.accountID)">
                    <ion-icon name="mail-outline" size="large" (click)="resend(element.accountID)"></ion-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsAccount"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsAccount;"></tr>
            </table>

          </mat-expansion-panel>
          <mat-expansion-panel [disabled]="ExpansionPanelHomeDisable" [expanded]="ExpansionPanelHomeExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="iconMargin">home</mat-icon>
                Hogares
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="divFiltroAndCopy">
              <div class="divFiltro">
                <mat-form-field appearance="outline">
                  <mat-label>Filtro</mat-label>
                  <input matInput (keyup)="applyFilter($event, 'Homes')" [(ngModel)]="filterHomeInput"
                    placeholder="Filtro ... " #input>
                  <button *ngIf="filterHomeInput" matSuffix mat-icon-button aria-label="Clear"
                    (click)="applyFilter($event, 'Homes')">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div class="divCopy">
                <button mat-icon-button (click)="copyData('Homes')">
                  <mat-icon>assignment</mat-icon>
                </button>
              </div>
            </div>
            <table mat-table [dataSource]="dsHomes">

              <!--- Note that these columns can be defined in any order.
                The actual rendered columns are set as a property on the row definition" -->

              <!-- HomeID Column -->
              <ng-container matColumnDef="homeID">
                <th mat-header-cell *matHeaderCellDef> HomeID </th>
                <td mat-cell *matCellDef="let element"> {{element.homeID}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="homeName">
                <th mat-header-cell *matHeaderCellDef> Hogar </th>
                <td mat-cell *matCellDef="let element"> {{element.homeName}} </td>
              </ng-container>

              <!-- CreationDateLocal Column -->
              <ng-container matColumnDef="creationDateLocal">
                <th mat-header-cell *matHeaderCellDef> Fecha de Creación (UTC) </th>
                <td mat-cell *matCellDef="let element"> {{element.creationDateLocal | date:'yyyy-MM-dd HH:mm:ss'}} </td>
              </ng-container>

              <!-- TimeZoneDescription Column -->
              <ng-container matColumnDef="timeZoneDescription">
                <th mat-header-cell *matHeaderCellDef> Zona horaria </th>
                <td mat-cell *matCellDef="let element"> {{element.timeZoneDescription}} </td>
              </ng-container>

              <!-- OffSet Column -->
              <ng-container matColumnDef="offSet">
                <th mat-header-cell *matHeaderCellDef> Dif. horaria UTC </th>
                <td mat-cell *matCellDef="let element"> {{element.offSet}} </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsHomes"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsHomes;"></tr>
            </table>
          </mat-expansion-panel>

          <mat-expansion-panel [disabled]="ExpansionPanelHubDisable" [expanded]="ExpansionPanelHubExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="iconMargin">dns</mat-icon>
                Hubs
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="divFiltroAndCopy">
              <div class="divFiltro">
                <mat-form-field appearance="outline">
                  <mat-label>Filtro</mat-label>
                  <input matInput (keyup)="applyFilter($event, 'Hubs')" [(ngModel)]="filterHubsInput"
                    placeholder="Filtro ... " #input>
                  <button *ngIf="filterHubsInput" matSuffix mat-icon-button aria-label="Clear"
                    (click)="applyFilter($event, 'Hubs')">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div class="divCopy">
                <button mat-icon-button (click)="copyData('Hubs')">
                  <mat-icon>assignment</mat-icon>
                </button>
              </div>
            </div>
            <table mat-table [dataSource]="dsHubs" #tableHubs>
              <!--- Note that these columns can be defined in any order.
                The actual rendered columns are set as a property on the row definition" -->

              <!-- HomeID Column -->
              <ng-container matColumnDef="deviceID">
                <th mat-header-cell *matHeaderCellDef ngClass="IDWidthClass"> DeviceID </th>
                <td mat-cell *matCellDef="let element" ngClass="IDWidthClass"> {{element.deviceID}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="homeName">
                <th mat-header-cell *matHeaderCellDef ngClass="DescriptionWidthClass"> Hogar </th>
                <td mat-cell *matCellDef="let element" ngClass="DescriptionWidthClass">
                  <div class="overflow-ellipsisDescription">{{element.homeName}}</div>
                </td>
              </ng-container>

              <ng-container matColumnDef="deviceName">
                <th mat-header-cell *matHeaderCellDef ngClass="DescriptionWidthClass"> Nombre </th>
                <td mat-cell *matCellDef="let element" ngClass="DescriptionWidthClass">
                  <div class="overflow-ellipsisDescription">{{element.deviceName}}</div>
                </td>
              </ng-container>

              <ng-container matColumnDef="model">
                <th mat-header-cell *matHeaderCellDef ngClass="customWidthClass"> Modelo </th>
                <td mat-cell *matCellDef="let element" ngClass="customWidthClass"> {{element.model}} </td>
              </ng-container>

              <!-- CreationDateLocal Column -->
              <ng-container matColumnDef="creationDateLocal">
                <th mat-header-cell *matHeaderCellDef ngClass="DateWidthClass">
                  Fecha de creación (UTC) </th>
                <td mat-cell *matCellDef="let element" ngClass="DateWidthClass">
                  {{element.creationDateLocal | date:'yyyy-MM-dd HH:mm:ss'}}
                </td>
              </ng-container>

              <!-- Virtual Column -->
              <ng-container matColumnDef="mac">
                <th mat-header-cell *matHeaderCellDef ngClass="customWidthClass"> MAC Address </th>
                <td mat-cell *matCellDef="let element" ngClass="customWidthClass">
                  <div class="overflow-ellipsisDescription">{{element.mac}}</div>
                </td>
              </ng-container>

              <!-- TimeZoneDescription Column -->
              <ng-container matColumnDef="currentFirmwareVersion">
                <th mat-header-cell *matHeaderCellDef ngClass="customWidthClass"> Firmware actual </th>
                <td mat-cell *matCellDef="let element" ngClass="customWidthClass">
                  {{element.currentFirmwareVersion}} </td>
              </ng-container>

              <!-- TimeZoneDescription Column -->
              <ng-container matColumnDef="lastestVersion">
                <th mat-header-cell *matHeaderCellDef ngClass="IDWidthClass"> Ult. Firmware disp. </th>
                <td mat-cell *matCellDef="let element" ngClass="IDWidthClass"> {{element.lastestVersion}}
                </td>
              </ng-container>

              <ng-container matColumnDef="colorActivity" hidden="true">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                </td>
              </ng-container>

              <!-- TimeZoneDescription Column -->
              <ng-container matColumnDef="lastReportedActivity">
                <th mat-header-cell *matHeaderCellDef ngClass="DateWidthClass"> Ult. actividad</th>
                <td mat-cell *matCellDef="let element" ngClass="DateWidthClass">
                  <mat-icon *ngIf="element.model !== 'YALE4500'"
                    [ngClass]="{'circle-green-color' : element.colorActivity == 'green', 'circle-yellow-color' : element.colorActivity == 'yellow', 'circle-red-color' : element.colorActivity == 'red'}">
                    circle
                  </mat-icon>
                  {{element.model !== 'YALE4500' ? element.lastReportedActivity : ''}}
                </td>
              </ng-container>

              <!-- TimeZoneDescription Column -->
              <!-- <ng-container matColumnDef="lastActivityLocal">
                <th mat-header-cell *matHeaderCellDef ngClass="DateWidthClass"> Fecha ult. act. (CUS)
                </th>
                <td mat-cell *matCellDef="let element" ngClass="DateWidthClass">
                  {{element.lastActivityLocal |
                  date:'yyyy-MM-dd HH:mm:ss'}}
                </td>
              </ng-container> -->
              <tr mat-header-row *matHeaderRowDef="displayedColumnsHubs"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsHubs;"></tr>
            </table>
          </mat-expansion-panel>
          <mat-expansion-panel [disabled]="ExpansionPanelDeviceDisable" [expanded]="ExpansionPanelDeviceExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="iconMargin">devices</mat-icon>
                Dispositivos
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="divFiltroAndCopy">
              <div class="divFiltro">
                <mat-form-field appearance="outline">
                  <mat-label>Filtro</mat-label>
                  <input matInput (keyup)="applyFilter($event, 'Devices')" [(ngModel)]="filterDevicesInput"
                    placeholder="Filtro ... " #input>
                  <button *ngIf="filterDevicesInput" matSuffix mat-icon-button aria-label="Clear"
                    (click)="applyFilter($event, 'Devices')">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div class="divCopy">
                <button mat-icon-button (click)="copyData('Devices')">
                  <mat-icon>assignment</mat-icon>
                </button>
              </div>
            </div>
            <table mat-table [dataSource]="dsDevices" style="overflow-x: scroll;min-width: max-content;">

              <!--- Note that these columns can be defined in any order.
                The actual rendered columns are set as a property on the row definition" -->

              <!-- HomeID Column -->
              <ng-container matColumnDef="endPointID">
                <th mat-header-cell *matHeaderCellDef> EndPointID </th>
                <td mat-cell *matCellDef="let element"> {{element.endPointID}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="home">
                <th mat-header-cell *matHeaderCellDef> Hogar </th>
                <td mat-cell *matCellDef="let element"> {{element.home}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="hub">
                <th mat-header-cell *matHeaderCellDef> Hub </th>
                <td mat-cell *matCellDef="let element"> {{element.hub}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="endpointModel">
                <th mat-header-cell *matHeaderCellDef> Modelo </th>
                <td mat-cell *matCellDef="let element"> {{element.endpointModel}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="endPoint">
                <th mat-header-cell *matHeaderCellDef> Nombre del EP </th>
                <td mat-cell *matCellDef="let element"> {{element.endPoint}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="endPointAddress">
                <th mat-header-cell *matHeaderCellDef> Dir. EP </th>
                <td mat-cell *matCellDef="let element"> {{element.endPointAddress}} </td>
              </ng-container>


              <!-- HomeName Column -->
              <ng-container matColumnDef="state">
                <th mat-header-cell *matHeaderCellDef> Estado (Ult. Reportado) </th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon *ngIf="element.model !== 'XTR' &&  element.model !== 'SUPERIMPOSE'">
                    {{element.state == 'Locked' ? 'lock' : element.state == 'Unlocked' ? 'lock_open' :
                    'report_problem'}}
                  </mat-icon>
                  {{element.model !== 'XTR' && element.model !== 'SUPERIMPOSE' ? element.state : 'DESCONOCIDO'}}
                </td>
              </ng-container>

              <!-- HomeName Column
              <ng-container matColumnDef="battery">
                <th mat-header-cell *matHeaderCellDef> Bateria </th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon>
                    {{element.battery == 'OK' ? 'battery_charging_full' : 'battery_alert'}}
                  </mat-icon>
                  {{element.battery}}
                </td>
              </ng-container> -->

              <ng-container matColumnDef="colorActivity" hidden="true">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                </td>
              </ng-container>

              <!-- TimeZoneDescription Column -->
              <ng-container matColumnDef="lastReportedActivity">
                <th mat-header-cell *matHeaderCellDef> Ult. actividad</th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon *ngIf="element.model !== 'XTR' &&  element.model !== 'SUPERIMPOSE'"
                    [ngClass]="{'circle-green-color' : element.colorActivity == 'green', 'circle-yellow-color' : element.colorActivity == 'yellow', 'circle-red-color' : element.colorActivity == 'red'}">
                    circle
                  </mat-icon>
                  {{element.model !== 'XTR' && element.model !== 'SUPERIMPOSE' ? element.lastReportedActivity : ''}}
                </td>
              </ng-container>

              <!-- CreationDateLocal Column -->
              <!-- <ng-container matColumnDef="dateTimeCreatedLocal">
                <th mat-header-cell *matHeaderCellDef> Fecha ult. act. (CUS) </th>
                <td mat-cell *matCellDef="let element"> {{element.dateTimeCreatedLocal | date:'yyyy-MM-dd HH:mm:ss'}}
                </td>
              </ng-container> -->

              <tr mat-header-row *matHeaderRowDef="displayedColumnsDevices"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsDevices;"></tr>
            </table>
          </mat-expansion-panel>
          <mat-expansion-panel [disabled]="ExpansionPanelGuestDisable" [expanded]="ExpansionPanelGuestExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="iconMargin">group</mat-icon>
                Invitados
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="divFiltroAndCopy">
              <div class="divFiltro">
                <mat-form-field appearance="outline">
                  <mat-label>Filtro</mat-label>
                  <input matInput (keyup)="applyFilter($event, 'Guests')" [(ngModel)]="filterGuestsInput"
                    placeholder="Filtro ... " #input>
                  <button *ngIf="filterGuestsInput" matSuffix mat-icon-button aria-label="Clear"
                    (click)="applyFilter($event, 'Guests')">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div class="divCopy">
                <button mat-icon-button (click)="copyData('Guests')">
                  <mat-icon>assignment</mat-icon>
                </button>
              </div>
            </div>
            <table mat-table [dataSource]="dsGuests" id="stats">

              <!--- Note that these columns can be defined in any order.
                The actual rendered columns are set as a property on the row definition" -->

              <!-- HomeID Column -->
              <ng-container matColumnDef="userID">
                <th mat-header-cell *matHeaderCellDef> UserID </th>
                <td mat-cell *matCellDef="let element"> {{element.userID}} </td>
              </ng-container>

              <!-- HomeID Column -->
              <ng-container matColumnDef="home">
                <th mat-header-cell *matHeaderCellDef> Hogar </th>
                <td mat-cell *matCellDef="let element"> {{element.home}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef> Email </th>
                <td mat-cell *matCellDef="let element">
                  <div style="display: flex;">
                    <mat-icon *ngIf="element.email != null" (click)="dataLoad('guest',element)">search</mat-icon>
                    <mat-label>
                      {{element.email}}
                    </mat-label>
                  </div>
                </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="guestName">
                <th mat-header-cell *matHeaderCellDef> Invitado </th>
                <td mat-cell *matCellDef="let element"> {{element.guestName}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="endPointName">
                <th mat-header-cell *matHeaderCellDef> Nombre del EP </th>
                <td mat-cell *matCellDef="let element"> {{element.endPointName}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="createdOnLocal">
                <th mat-header-cell *matHeaderCellDef> F. creacion (CLI) </th>
                <td mat-cell *matCellDef="let element"> {{element.createdOnLocal | date:'yyyy-MM-dd HH:mm:ss'}}
                </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="fromDateLocalFromTime">
                <th mat-header-cell *matHeaderCellDef> Habilitado desde (CLI) </th>
                <td mat-cell *matCellDef="let element"> {{element.fromDateLocalFromTime}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="toDateLocalToTime">
                <th mat-header-cell *matHeaderCellDef> Habilitado hasta (CLI)</th>
                <td mat-cell *matCellDef="let element"> {{element.toDateLocalToTime}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="d">
                <th mat-header-cell *matHeaderCellDef style="text-align: center;"> D </th>
                <td mat-cell *matCellDef="let element" style="text-align: center;">
                  <mat-icon [ngClass]="{'colorGreen' : element.d == true, 'colorRed' : element.d == false}">
                    {{element.d == true ? 'done' : 'clear'}}
                  </mat-icon>
                </td>
              </ng-container>

              <ng-container matColumnDef="l">
                <th mat-header-cell *matHeaderCellDef style="text-align: center;"> L </th>
                <td mat-cell *matCellDef="let element" style="text-align: center;">
                  <mat-icon [ngClass]="{'colorGreen' : element.l == true, 'colorRed' : element.l == false}">
                    {{element.l == true ? 'done' : 'clear'}}
                  </mat-icon>
                </td>
              </ng-container>

              <ng-container matColumnDef="m">
                <th mat-header-cell *matHeaderCellDef style="text-align: center;"> M </th>
                <td mat-cell *matCellDef="let element" style="text-align: center;">
                  <mat-icon [ngClass]="{'colorGreen' : element.m == true, 'colorRed' : element.m == false}">
                    {{element.m == true ? 'done' : 'clear'}}
                  </mat-icon>
                </td>
              </ng-container>

              <ng-container matColumnDef="mi">
                <th mat-header-cell *matHeaderCellDef style="text-align: center;"> Mi </th>
                <td mat-cell *matCellDef="let element" style="text-align: center;">
                  <mat-icon [ngClass]="{'colorGreen' : element.mi == true, 'colorRed' : element.mi == false}">
                    {{element.mi == true ? 'done' : 'clear'}}
                  </mat-icon>
                </td>
              </ng-container>

              <ng-container matColumnDef="j" style="text-align: center;">
                <th mat-header-cell *matHeaderCellDef style="text-align: center;"> J </th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon [ngClass]="{'colorGreen' : element.j == true, 'colorRed' : element.j == false}">
                    {{element.j == true ? 'done' : 'clear'}}
                  </mat-icon>
                </td>
              </ng-container>

              <ng-container matColumnDef="v" style="text-align: center;">
                <th mat-header-cell *matHeaderCellDef style="text-align: center;"> V </th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon [ngClass]="{'colorGreen' : element.v == true, 'colorRed' : element.v == false}">
                    {{element.v == true ? 'done' : 'clear'}}
                  </mat-icon>
                </td>
              </ng-container>

              <ng-container matColumnDef="s" style="text-align: center;">
                <th mat-header-cell *matHeaderCellDef style="text-align: center;"> S </th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon [ngClass]="{'colorGreen' : element.s == true, 'colorRed' : element.s == false}">
                    {{element.s == true ? 'done' : 'clear'}}
                  </mat-icon>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsGuests"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsGuests;"></tr>
              <!-- Row shown when there is no matching data. -->
              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">No se ha encontrado el valor "{{input.value}}"</td>
              </tr>
            </table>
          </mat-expansion-panel>
          <mat-expansion-panel [disabled]="ExpansionPanelRateScoreDisable" [expanded]="ExpansionPanelRateScoreExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="iconMargin">equalizer</mat-icon>
                Calificación NPS
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="divFiltroAndCopy">
              <div class="divFiltro">
                <mat-form-field appearance="outline">
                  <mat-label>Filtro</mat-label>
                  <input matInput (keyup)="applyFilter($event, 'RateScore')" [(ngModel)]="filterRatescoreInput"
                    placeholder="Filtro ... " #input>
                </mat-form-field>
                <button *ngIf="filterRatescoreInput" matSuffix mat-icon-button aria-label="Clear"
                  (click)="applyFilter($event, 'RateScore')">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <div class="divCopy">
                <button mat-icon-button (click)="copyData('RateScore')">
                  <mat-icon>assignment</mat-icon>
                </button>
              </div>
            </div>
            <table mat-table [dataSource]="dsRateScore">
              <!--- Note that these columns can be defined in any order.
                The actual rendered columns are set as a property on the row definition" -->
              <!-- HomeName Column -->
              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef style="width: 40%; padding: 0 5px; text-align:center;">
                  Comentario </th>
                <td mat-cell *matCellDef="let element" style="width: 40%; padding: 0 5px"> {{element.description !=
                  'NULL' ? element.description : '(Sin Comentarios)'}} </td>
              </ng-container>

              <ng-container matColumnDef="score">
                <th mat-header-cell *matHeaderCellDef style="width: 35%; padding: 0 5px; text-align:center;"> Valoración
                </th>
                <td mat-cell *matCellDef="let element" style="width: 35%; padding: 0 5px; text-align:center;">
                  <rating style="color: #0275d8;font-size: 40px;" ngModel="{{element.score}}" [max]="10"
                    [readonly]="true">
                  </rating>
                  <!-- <pre class="card-block card-header" style="margin:15px 0;"> -->
                  <b>&nbsp;&nbsp;&nbsp;{{element.score}}</b>
                  <!-- </pre> -->
                </td>
              </ng-container>

              <!-- CreationDateLocal Column -->
              <ng-container matColumnDef="rateUTCDateTime">
                <th mat-header-cell *matHeaderCellDef style="width: 25%; padding: 0 5px; text-align:center;"> Fecha
                  valoración </th>
                <td mat-cell *matCellDef="let element" style="width: 25%; padding: 0 5px; text-align:center;">
                  {{element.rateUTCDateTime | date:'yyyy-MM-dd HH:mm:ss'}} </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsRateScore"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsRateScore;"></tr>
            </table>
          </mat-expansion-panel>
          <mat-expansion-panel [disabled]="ExpansionPanelAccessControlEntriesDisable"
            [expanded]="ExpansionPanelAccessControlEntriesExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="iconMargin">visibility</mat-icon>
                Registros de Uso
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="divFiltroAndCopy">
              <div class="divFiltro">
                <mat-form-field appearance="outline">
                  <mat-label>Filtro</mat-label>
                  <input matInput (keyup)="applyFilter($event, 'AccessEntries')" [(ngModel)]="filterAccessEntriesInput"
                    placeholder="Filtro ... " #input>
                </mat-form-field>
                <button *ngIf="filterAccessEntriesInput" matSuffix mat-icon-button aria-label="Clear"
                  (click)="applyFilter($event, 'AccessEntries')">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <div class="divCopy">
                <button mat-icon-button (click)="copyData('AccessControlEntries')">
                  <mat-icon>assignment</mat-icon>
                </button>
              </div>
            </div>
            <table mat-table [dataSource]="dsAccessControlEntries">
              <!--- Note that these columns can be defined in any order.
                The actual rendered columns are set as a property on the row definition" -->

              <!-- HomeID Column -->
              <ng-container matColumnDef="accessControlEntryID">
                <th mat-header-cell *matHeaderCellDef> ACE_ID </th>
                <td mat-cell *matCellDef="let element"> {{element.accessControlEntryID}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="endpointID">
                <th mat-header-cell *matHeaderCellDef> EP_ID </th>
                <td mat-cell *matCellDef="let element"> {{element.endpointID}} </td>
              </ng-container>


              <!-- HomeName Column -->
              <ng-container matColumnDef="eventDateTimeLocalTime">
                <th mat-header-cell *matHeaderCellDef> F. Evento (CLI) </th>
                <td mat-cell *matCellDef="let element"> {{element.eventDateTimeLocalTime | date:'yyyy-MM-dd HH:mm:ss'}}
                </td>
              </ng-container>


              <!-- HomeName Column -->
              <ng-container matColumnDef="statusDescription">
                <th mat-header-cell *matHeaderCellDef> Estado </th>
                <td mat-cell *matCellDef="let element"> {{element.statusDescription}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="reasonDescription">
                <th mat-header-cell *matHeaderCellDef> Motivo </th>
                <td mat-cell *matCellDef="let element"> {{element.reasonDescription == 'Unknown' ? '' :
                  element.reasonDescription}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="sourceDescription">
                <th mat-header-cell *matHeaderCellDef> Origen </th>
                <td mat-cell *matCellDef="let element"> {{element.sourceDescription}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="userName">
                <th mat-header-cell *matHeaderCellDef> Usuario </th>
                <td mat-cell *matCellDef="let element"> {{element.userName}} </td>
              </ng-container>

              <!-- HomeName Column -->
              <ng-container matColumnDef="endpointDescription">
                <th mat-header-cell *matHeaderCellDef> EP Des. </th>
                <td mat-cell *matCellDef="let element"> {{element.endpointDescription}} </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsAccessControlEntries"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsAccessControlEntries;"></tr>
            </table>
          </mat-expansion-panel>
          <mat-expansion-panel [disabled]="ExpansionPanelCommunicationDisable"
            [hidden]="ExpansionPanelCommunicationHidden" [expanded]="ExpansionPanelCommunicationExpanded">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="iconMargin">cell_wifi</mat-icon>
                Comunicación
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="divFiltroAndCopy">
              <div class="divFiltro">
                <mat-form-field appearance="outline">
                  <mat-label>Filtro</mat-label>
                  <input matInput (keyup)="applyFilter($event, 'Communication')" [(ngModel)]="filterCommunicationInput"
                    placeholder="Filtro ... " #input>
                  <button *ngIf="filterCommunicationInput" matSuffix mat-icon-button aria-label="Clear"
                    (click)="applyFilter($event, 'Communication')">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div class="divCopy">
                <button mat-icon-button (click)="copyData('Communication')">
                  <mat-icon>assignment</mat-icon>
                </button>
              </div>
            </div>
            <table mat-table [dataSource]="dsCommunication" style="overflow-x: scroll;min-width: max-content;">

              <ng-container matColumnDef="acSynch_ID">
                <th mat-header-cell *matHeaderCellDef> ACS_ID </th>
                <td mat-cell *matCellDef="let element"> {{element.acSynch_ID}} </td>
              </ng-container>

              <ng-container matColumnDef="thread">
                <th mat-header-cell *matHeaderCellDef> Slot </th>
                <td mat-cell *matCellDef="let element"> {{element.thread}} </td>
              </ng-container>

              <ng-container matColumnDef="oper">
                <th mat-header-cell *matHeaderCellDef> Oper. </th>
                <td mat-cell *matCellDef="let element"> {{element.oper}} </td>
              </ng-container>

              <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef> Tipo </th>
                <td mat-cell *matCellDef="let element"> {{element.type}} </td>
              </ng-container>

              <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef> Rol </th>
                <td mat-cell *matCellDef="let element"> {{element.role}} </td>
              </ng-container>

              <ng-container matColumnDef="user">
                <th mat-header-cell *matHeaderCellDef> Usuario </th>
                <td mat-cell *matCellDef="let element">
                  <div class="overflow-ellipsisDescription">{{element.user}}</div>
                </td>
              </ng-container>

              <ng-container matColumnDef="endpoint">
                <th mat-header-cell *matHeaderCellDef> Endpoint </th>
                <td mat-cell *matCellDef="let element">
                  <div class="overflow-ellipsisDescription">{{element.endpoint}}</div>
                </td>
              </ng-container>

              <ng-container matColumnDef="colorActivityEPA" hidden="true">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                </td>
              </ng-container>

              <!-- TimeZoneDescription Column -->
              <ng-container matColumnDef="lastEndpointActivity">
                <th mat-header-cell *matHeaderCellDef> T. ACK. Ult. Falla</th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon *ngIf="element.colorActivityEPA != ''"
                    [ngClass]="{'circle-green-color' : element.colorActivityEPA == 'green', 'circle-yellow-color' : element.colorActivityEPA == 'yellow', 'circle-red-color' : element.colorActivityEPA == 'red'}">
                    circle
                  </mat-icon>
                  {{element.lastEndpointActivity}}
                </td>
              </ng-container>

              <ng-container matColumnDef="attempts">
                <th mat-header-cell *matHeaderCellDef> Intentos </th>
                <td mat-cell *matCellDef="let element" [ngStyle]="{'color':element.attempts>1?'red':'black'}">
                  {{element.attempts}}
                </td>
              </ng-container>

              <ng-container matColumnDef="createdDateLocal">
                <th mat-header-cell *matHeaderCellDef> Fecha Creación (CUS) </th>
                <td mat-cell *matCellDef="let element"> {{element.createdDateLocal | date:'MM-dd HH:mm:ss'}}
                </td>
              </ng-container>

              <ng-container matColumnDef="retryDateLocal">
                <th mat-header-cell *matHeaderCellDef> Hora intento </th>
                <td mat-cell *matCellDef="let element"> {{element.retryDateLocal | date:'HH:mm:ss'}}
                </td>
              </ng-container>

              <ng-container matColumnDef="completedDateLocal">
                <th mat-header-cell *matHeaderCellDef> Hora fin COM</th>
                <td mat-cell *matCellDef="let element"> {{element.completedDateLocal | date:'HH:mm:ss'}}
                </td>
              </ng-container>

              <ng-container matColumnDef="colorActivity" hidden="true">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                </td>
              </ng-container>

              <ng-container matColumnDef="elapsedTime">
                <th mat-header-cell *matHeaderCellDef> Tiempo COM </th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon
                    [ngClass]="{'circle-green-color' : element.colorActivity == 'green', 'circle-yellow-color' : element.colorActivity == 'yellow', 'circle-red-color' : element.colorActivity == 'red'}">
                    circle
                  </mat-icon>
                  {{element.elapsedTime}}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsCommunication"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsCommunication;"></tr>
            </table>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>
  </div>
</ion-content>